---
title: Insert title here
key: d11273f1ad194664904c6212fe921d45

---
## Fitting ARMA models

```yaml
type: "TitleSlide"
key: "34934da233"
```

`@lower_third`

name: James Fulton
title: Climate Informatics Researcher, University of Edinburgh


`@script`
In this chapter we will cover how to fit the AR, MA and ARMA models we have been learning about; and crucially, which of these to pick


---
## Choosing a Model

```yaml
type: "FullSlide"
key: "84d44d8f3d"
```

`@part1`
![](https://assets.datacamp.com/production/repositories/4399/datasets/3993f6a5f34d7066170ced321f60b50d73bed639/MA-AR%20comparison%20data.png)


`@script`
It is hard to choose which of our models we should fit by looking at the time series. In the left figure we have data generated by an AR(1) model, on the right, from an MA(1) model. They look very similar, but the model we choose is very important. If we make the wrong choice of model to fit we can end up with poor forecasts.


---
## Autocorrelation Functions and Partial Autocorrelation Functions

```yaml
type: "TwoColumns"
key: "918ab6f697"
```

`@part1`
**ACF - Autocorrelation Function**

Correlation at lag-step n


`@part2`
**PACF - Partial Autocorrelation Function**

Correlation at lag-step n which isn't due to correlation at lag-step less than n


`@script`
In order to choose a model we use the autocorrelation function ACF and Partial autocorrelation function PACF

We talked about autocorrelation when we introduced the AR model. The ACF is applied to data and tells us how much our time series is correlated with itself at a lag of n

The Partial autocorrelation function is the degree of correlation at step n after removing the correlations at smaller lags than n.

We can use these two metrics to decide what kind of model is the best fit to our data


---
## ACF and PACF

```yaml
type: "TwoColumns"
key: "0d45af2765"
```

`@part1`
**AR(1)**
![](https://assets.datacamp.com/production/repositories/4399/datasets/cf381f21e06d00a2a8a3c126a7cd18b728fdd634/AR1_acf_only.png)

![](https://assets.datacamp.com/production/repositories/4399/datasets/31c38267134d29a1800704c77924ee2e97cdc2a2/AR1_pacf_only.png)


`@part2`
**MA(1)**{{1}}

![](https://assets.datacamp.com/production/repositories/4399/datasets/3609fa97b316a9a73758d118d08a18c7cb5fc79a/MA1_acf_only.png){{1}}

![](https://assets.datacamp.com/production/repositories/4399/datasets/7fa9cb117d0e26cce7e39904d10d41fd18c8d042/MA1_pacf_only.png){{1}}


`@script`
If the data is characterised by an AR model then the ACF will tail off gradually, whilst the PACF will drop off suddenly after lag p. In this example, where we have an AR(1) model, you can see that the PACF drops off after lag 1. The area shaded in blue shows the values of ACF and PCAF which are not statistically significant

*If the data is characterised by an MA model then the ACF will drop off suddenly after lag q and the PACF will tail off gradually. Here we have an MA(1) model, you can see that the ACF drops off after lag 1. Here it is the amplitude of PACF that tails off gradually and it oscillates between positive and negative.

We can use these plots to pick the model, and the order of the model

If the data is characterised by an ARMA model then both the ACF and the PACF tail off. In this case it is harder to pick the model parameters p and q. We will come back to this in a later chapter.


---
## ACF and PACF Summary Table

```yaml
type: "FullSlide"
key: "19fd4879f3"
```

`@part1`
![](https://assets.datacamp.com/production/repositories/4399/datasets/7a3fcce90d063c3fed1bec4ee1045ce75f4114e0/acf_table.PNG)


`@script`
The following table summarises what we have just covered about ACF and PACF. You will use it in the exercises


---
## ACF and PCF Code

```yaml
type: "FullSlide"
key: "525900e8c9"
```

`@part1`
```python
import statsmodels.api as sm
fig1 = sm.graphics.tsa.plot_acf(df_train, lags=20)
fig2 = sm.graphics.tsa.plot_pacf(df_train, lags=20)
plt.show()
```


![](https://assets.datacamp.com/production/repositories/4399/datasets/be292285da6463e6abe467897e2661b57ff3599c/AR1_pacf.png)


`@script`
To generate this plots in the exercises you will use the graphics submodule from statsmodels. Here df_train is our dataset and lags=20 is the maximum number of lags we would like to see plotted


---
## Fitting the Flu

```yaml
type: "TwoColumns"
key: "3c379cc01a"
```

`@part1`
![](https://assets.datacamp.com/production/repositories/4399/datasets/4ce204196f99a42a819a5bd8a31c8393bf847b83/fake_flu_all.png)


`@part2`
![](https://assets.datacamp.com/production/repositories/4399/datasets/7a3fcce90d063c3fed1bec4ee1045ce75f4114e0/acf_table.PNG){{1}}

![](https://assets.datacamp.com/production/repositories/4399/datasets/a282ba489c48e40ab703f7a88dff7e5091e6bf69/ARMA11_pacf.png){{1}}


`@script`
Now we have a method to choose between models lets go ahead and fit one. The following is a fictitious data set showing flu outbreaks. Our task is to model the data and make future predictions of flu rate.

*The ACF and PACF trail off so an ARMA model will be best.


---
## Fitting the Flu

```yaml
type: "FullSlide"
key: "293ab0de72"
```

`@part1`
```python
from statsmodels.tsa.arima_model import ARMA
```
```python
ARMA(df, order=(p,q))
```

- p: number of autoregression lags{{2}}
- q: number of movign average lags{{2}}

```python
model = ARMA(df, order=(1,1))
```{{2}}

```python
results = model.fit()
```{{3}}


`@script`
We import the ARMA model from the statmodels package like this.

*To fit a model, first we instantiate the model object, passing it the data and the order. Lets use p and q both equal to 1 since this is the simplest ARMA model possible.

*Next we call the model's fit method and assign the returned ARMA results object to a variable.


---
## Fitting the Flu

```yaml
type: "FullSlide"
key: "ed82afe57d"
```

`@part1`
```python
results.summary().tables[1]
```

```python
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
ar.L1          0.9865      0.010    102.878      0.000       0.968       1.005
ma.L1          0.3630      0.058      6.207      0.000       0.248       0.478
sigma2         1.0410      0.091     11.418      0.000       0.862       1.220
==============================================================================
```{{1}}


`@script`
We can show the summary of the model fit to find the ar and ma parameters recovered, as well as the level of noise.


---
## Predicting the Flu

```yaml
type: "FullSlide"
key: "c96a001216"
```

`@part1`
```python
future_predictions = results.get_prediction(start='2018-09-08')
```
![](https://assets.datacamp.com/production/repositories/4399/datasets/8eb3d1da5be9e92d010e7fd07fe3397ca2747240/fake_flu_pred.png)


`@script`
Using the fitted model we can now make predictions about future flu rate using the get_predictions method. We'll discuss forecasts further in a later video but for now we can take a closer look at how close our predictions are to reality


---
## Predicting the Flu

```yaml
type: "FullSlide"
key: "1598f4afa5"
disable_transition: true
```

`@part1`
![](https://assets.datacamp.com/production/repositories/4399/datasets/21235f85b3ec5d0e9d03dc2f771d79411a95ef57/fake_flu_pred_zoom.png)


`@script`
Not bad! And now...


---
## Let's practice!

```yaml
type: "FinalSlide"
key: "8ca7b9d309"
```

`@script`
Let's practice!

