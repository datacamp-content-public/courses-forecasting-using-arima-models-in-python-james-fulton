---
title: Insert title here
key: d11273f1ad194664904c6212fe921d45

---
## Fitting ARMA models

```yaml
type: "TitleSlide"
key: "34934da233"
```

`@lower_third`

name: James Fulton
title: Climate Informatics Researcher, University of Edinburgh


`@script`
Now we know what the ARMA model is. In this chapter we will learn how to generate synthetic data and how to fit these models to that data.


---
## Generating Time Series Data

```yaml
type: "FullSlide"
key: "fb00859de8"
center_content: false
```

`@part1`
```python
from statsmodels.tsa.arima_process import arma_generate_sample
```{{1}}

```python
arma_generate_sample(ar, ma, nsample, sigma=1)
```{{2}}

Generate an AR(1) model{{3}}

```python
import numpy as np
ar_coeffs = np.array([0.5])
ma_coeffs = np.array([])
```{{3}}

Be careful defining the input{{4}}
```python
ar = np.hstack([1, -ar_coeffs])
ma = np.hstack([1,  ma_coeffs])
```{{4}}


`@script`
The statsmodels package has great an inbuilt function which can be used to generate synthetic ARMA data. 

*This is the arma_generate_sample function which we import here.

*Into this function we need to pass ar (the autoregressive coefficients), ma (the moving average coefficients), nsamples (the number of samples to generate) and sigma (the standard deviation of the noise).

Here we will generate data which has a lag-one autoregressive coefficient of 0.5 and no moving average coefficients. This is an AR(1) model. 

*To do this, we make a numpy array with a single autoregressive coefficient of 0.5. We also create an empty numpy array for the moving average coefficients. 

There are two things we need to be careful of when using this function. 

* The first is that we need to specify the lag-0 coefficient of MA and AR. You will almost always set this to one. We use the numpy.hstack method to add a one onto the start of the coefficient arrays.

The second is that the arma_generate_sample function requires you to give it the negative of the autoregressive coefficients for lag greater than 1. We also do this inside the hstack function.


---
## Generating Time Series Data

```yaml
type: "FullSlide"
key: "734c4219ea"
```

`@part1`
```python
nsample = 100
sigma=1
```
```python
data = arma_generate_sample(ar, ma, nsample, sigma=sigma)
```{{1}}

```python
array([ 0.05185635, -0.44311913, -1.05776731, -0.03332579, -0.68884263,
       -0.26902862,  0.98686746,  0.27028874,  0.76555383, ...])
```{{2}}


`@script`
Finally, we will choose the number of samples to create and set the standard deviation of the noise.

*Then we can generate some data!

*This generated data is a sequence of values inside a numpy array


---
## Generating Time Series Data

```yaml
type: "FullSlide"
key: "1794b225dc"
disable_transition: true
```

`@part1`
```python
nsample = 100
sigma=1
```
```python
data = arma_generate_sample(ar, ma, nsample, sigma=sigma)
```

![](https://assets.datacamp.com/production/repositories/4399/datasets/3d69f249f72d221f9ec968b3174d73dda974f350/raw_generated_data.png)


`@script`
Which when we plot it looks like this.

Now, we are missing just one more data ingredient. The time stamp of each measurement.


---
## Adding Time Stamps

```yaml
type: "FullSlide"
key: "b1120206c7"
```

`@part1`
```python
import pandas as pd
dates = pd.date_range(start='2015-01-01', freq='D', periods=nsample)```

```python
df = pd.DataFrame(data, index=dates, columns=['time_series'])
```{{1}}

```python
            time_series
2015-01-01     0.051856
2015-01-02    -0.443119
2015-01-03    -1.057767
2015-01-04    -0.033326
2015-01-05    -0.688843
...
```{{2}}


`@script`
We import the pandas package to help us generate time stamps for each data point. 

Using the pandas.date_range function we can generate regularly spaced timestamps to attach to our synthetic data points. 

Here we specify the start time as the 1st January 2015, we specify the frequency as 'D' (for daily) and we create the same number of date stamps as we have data points

*Next we will combine our synthetic data and timestamps in a pandas dataframe

We fill the pandas dataframe by passing in our data, and giving it the column name 'time_series'. We also pass in our dates which will become the indices of the dataframe

*Our dataframe looks likes this, where our data are spaced one day apart


---
## Adding Time Stamps

```yaml
type: "FullSlide"
key: "bd8592f3fc"
disable_transition: true
```

`@part1`
```python
import pandas as pd
dates = pd.date_range(start='2015-01-01', freq='D', periods=nsample)```

```python
df = pd.DataFrame(data, index=dates, columns=['time_series'])
```

![](https://assets.datacamp.com/production/repositories/4399/datasets/dcaf17246c2965d2ba8175436ec2b353dc44f704/pandas_generated_data.png)


`@script`



---
## Fitting an AR model

```yaml
type: "FullSlide"
key: "293ab0de72"
```

`@part1`
```python
from statsmodels.tsa.arima_model import ARMA
```
```python
ARMA(df, order=(p,q))
```

- p: number of autoregression lags{{2}}
- q: number of movign average lags{{2}}

```python
model = ARMA(df, order=(1,0))
```{{2}}

```python
results = model.fit()
```{{3}}


`@script`
Great! We now have some data. Next we will use the ARMA model from the statsmodels package to fit the data that we created earlier. We import the model like this.

*To fit a model, first we instantiate the model object, passing it the data and the order. Remember that the data we generated was from a simple AR(1) model. Therefore p will be one and q will be zero in this case.

*Next we call the model's fit method and assign the returned ARMA results object to the variable results.

That's it! We have successfully generated synthetic AR data and fit a model to it!


---
## Fitting an AR model

```yaml
type: "FullSlide"
key: "ed82afe57d"
```

`@part1`
```python
results.summary().tables[1]
```

```python
=====================================================================================
                        coef    std err          z      P>|z|      [0.025      0.975]
-------------------------------------------------------------------------------------
const                 0.0725      0.209      0.347      0.729      -0.336       0.481
ar.L1.time_series     0.5737      0.083      6.908      0.000       0.411       0.736
=====================================================================================
```{{1}}


`@script`
We will explore the results object further in a later video 

*but for now, you can see in the bottom row of the results object table, the fitted AR coefficient is 0.57 +- 0.08. 

To generate the data we set this coefficient to 0.50. So the model has recovered our coefficient within one standard deviation of error


---
## Let's practice!

```yaml
type: "FinalSlide"
key: "8ca7b9d309"
```

`@script`
Now it's your turn! Let's practice!

