---
title: Insert title here
key: d11273f1ad194664904c6212fe921d45

---
## Fitting ARMA models

```yaml
type: "TitleSlide"
key: "34934da233"
```

`@lower_third`

name: James Fulton
title: Climate Informatics Researcher, University of Edinburgh


`@script`
Now we know what AR, MA and ARMA models are. In this chapter we will learn how to generate synthetic data and how to fit these models to that data. Let's get started.


---
## Generating Time Series Data

```yaml
type: "FullSlide"
key: "fb00859de8"
center_content: false
```

`@part1`
```python
from statsmodels.tsa.arima_process import arma_generate_sample
```{{1}}

```python
arma_generate_sample(ar, ma, nsample, sigma=1)
```{{2}}

Generate an AR(1) model{{3}}

```python
import numpy as np
ar_coeffs = np.array([0.5])
ma_coeffs = np.array([])
```{{3}}

```python
ar = np.hstack([1, -ar_coeffs])
ma = np.hstack([1,  ma_coeffs])
```{{4}}


`@script`
The statsmodels is the tool of choice for time series modelling in Python. It also has great an inbuilt function which will can be used to generate synthetic AR, MA or ARMA data. This is the arma_generate_sample function which we import here. Into this function we need to pass ar (the autoregressive coefficients), ma (the moving average coefficients), nsamples (the number of samples to generate) and sigma (the standard deviation of the noise).

Here we will generate data which has a lag-one autoregressive coefficient of 0.5 and no moving average coefficients. This equates to a AR(1) model. To do this, we make a numpy array with a single element of 0.5. This array will be the autoregressive coefficients. We also create an empty numpy array for the moving average coefficients. Even though we do not want any moving average coefficients we will need to pass this empty array into the function.

There are two things we need to be careful of when trying to use this function. 

The first is that we need to specify the lag 0 coefficient of MA and AR. You will almost always set this to 1 in practice and the situations where you won't are beyond the scope of this course.

The second thing is that the arma_generate_sample requires you to give it the negative of the autoregressive coefficients for lag greater than 1. 

We will use the numpy hstack function here to add the lag 1 coefficients to ar and ma and make sure we are passing the minus of the ar coefficients.


---
## Generating Time Series Data

```yaml
type: "FullSlide"
key: "734c4219ea"
```

`@part1`
```python
nsample = 100
sigma=1
```
```python
data = arma_generate_sample(ar, ma, nsample, sigma=sigma)
```{{1}}

```python
array([ 0.05185635, -0.44311913, -1.05776731, -0.03332579, -0.68884263,
       -0.26902862,  0.98686746,  0.27028874,  0.76555383, ...])
```{{2}}


`@script`
Finally, we will choose tothe number of samples to create (in this case 100) and set the noise standard deviation to 1.

Then we can generate some data!

The data we generate is a numpy array of values which is our generated time series data as a sequence.


---
## Generating Time Series Data

```yaml
type: "FullSlide"
key: "1794b225dc"
disable_transition: true
```

`@part1`
```python
nsample = 100
sigma=1
```
```python
data = arma_generate_sample(ar, ma, nsample, sigma=sigma)
```

![](https://assets.datacamp.com/production/repositories/4399/datasets/3d69f249f72d221f9ec968b3174d73dda974f350/raw_generated_data.png)


`@script`
If we plot this data we can conform that it looks like AR generated data.

Great! We have generated some time series data, except we are missing one finally ingredient. The actual time of each measurement. We have it as a sequence but we do not assigned any time spacing. It would be possible for us to continue without doing this step, but it isn't very realistic, in the wild you will always have time stamps along with each measurement, so lets create some time stamps to go along with this data


---
## Adding Time Stamps

```yaml
type: "FullSlide"
key: "b1120206c7"
```

`@part1`
```python
import pandas as pd
dates = pd.date_range(start='2015-01-01', freq='D', periods=nsample)```

```python
df = pd.DataFrame(data, index=dates, columns=['time_series'])
```{{1}}

```python
            time_series
2015-01-01     0.051856
2015-01-02    -0.443119
2015-01-03    -1.057767
2015-01-04    -0.033326
2015-01-05    -0.688843
...
```{{2}}


`@script`
We import the pandas package to help us generate time stamps for each data point. Using the pandas.date_range package we can generate regular timestamps to attach to each of our synthetic data points. 

Here we specify the start time as the 1st January 2015, we specify the frequency as 'D' (for daily) and we make the same number of date stamps as we have data points

Next we will combine our synthetic data and timestamps in a pandas dataframe, which is the most common way to represent data in python

We create a pandas dataframe and pass in our data giving it the column name 'time_series'. We also pass in our dates as indices for each data point using index=dates.

Our dataframe looks likes this


---
## Adding Time Stamps

```yaml
type: "FullSlide"
key: "bd8592f3fc"
disable_transition: true
```

`@part1`
```python
import pandas as pd
dates = pd.date_range(start='2015-01-01', freq='D', periods=nsample)```

```python
df = pd.DataFrame(data, index=dates, columns=['time_series'])
```

![](https://assets.datacamp.com/production/repositories/4399/datasets/dcaf17246c2965d2ba8175436ec2b353dc44f704/pandas_generated_data.png)


`@script`
When we plot our time series we can now put our dates along the x-axis.

Great! We have now generated some data. Next we will use the statsmodels package to fit a model to this data! Let's go!


---
## Fitting an AR model

```yaml
type: "FullSlide"
key: "293ab0de72"
```

`@part1`
```python
from statsmodels.tsa.arima_model import ARMA
```
```python
ARMA(df, order=(p,q))
```{{1}}

- p: number of autoregression lags{{2}}
- q: number of movign average lags{{2}}

```python
model = ARMA(df, order=(1,0))
```{{2}}

```python
results = model.fit()
```{{3}}


`@script`
We will use the ARMA model from within the statsmodels package to fit the data that we created earlier. We import it from the model like this.

The ARMA model has two required inputs. The data, and the order of the ARMA model.

To fit a model, first we create the model object, passing it the data and the order. The order of the model is the number of lags we use in autoregression and moving average. Remember that the data we generated was from a simple an AR(1) model. Therefore p will be one and q will be zero in this case.

Next we call the model's fit method and assign the returned ARMA results object to the variable results.

That's it! We have successfully generated synthetic AR data and fit a model to it!


---
## Fitting an AR model

```yaml
type: "FullSlide"
key: "ed82afe57d"
```

`@part1`
```python
results.summary().tables[1]
```

```python
=====================================================================================
                        coef    std err          z      P>|z|      [0.025      0.975]
-------------------------------------------------------------------------------------
const                 0.0725      0.209      0.347      0.729      -0.336       0.481
ar.L1.time_series     0.5737      0.083      6.908      0.000       0.411       0.736
=====================================================================================
```{{1}}


`@script`
We will explore the results object further in a later video but for now you can see in the bottom row of the results object table the fitted AR coefficient is 0.57 +- 0.08. To generate the data we set this coefficient to 0.50. So the model has recovered our coefficient within one standard deviation


---
## Generating and Fitting More Complex Models

```yaml
type: "FullSlide"
key: "94f8e6b720"
```

`@part1`
ARMA(2,2) model{{1}}
```python
ar_coefs = np.array([0.5,  0.5])
ma_coefs = np.array([0.5, -0.5])
```{{1}}

```python
ar = np.hstack([1, -ar_coefs])
ma = np.hstack([1,  ma_coefs])
data = arma_generate_sample(ar, ma, nsample, sigma=sigma)
```{{2}}


`@script`
We have generated data and fit an AR(1) model using the statsmodels package.

We have now covered almost everything we need to generate and fit more general ARMA models with autoregression and moving average coefficients at multiple lags. 

Here we generate an ARMA(2,2) model with two autoregressive lag coefficients and two moving average lag coefficients. We can repeat all the steps we used for the AR(1) data and generate this new data set.

We choose ARMA coefficients, we then add the zero lag coefficient and take the negative of the autoregressive coefficients and finally we generate the data.


---
## Generating and Fitting More Complex Models

```yaml
type: "FullSlide"
key: "acdbecdc8e"
disable_transition: true
```

`@part1`
```python
ar_coefs = np.array([0.5,  0.5])
ma_coefs = np.array([0.5, -0.5])
```

![](https://assets.datacamp.com/production/repositories/4399/datasets/2a4d489b987ee091fce17adfb34b860c010325b8/complex_pandas_generated_data.png)


`@script`
This new time series looks quite different to the AR(1) data w generated before. We are more likely to see this kind of more complex time series in the real world.


---
## Generating and Fitting More Complex Models

```yaml
type: "FullSlide"
key: "ab58c81457"
```

`@part1`
```python
ar_coefs = np.array([0.5,  0.5])
ma_coefs = np.array([0.5, -0.5])
```

```python
model = ARMA(df, order=(2,2))
```
```python
results = model.fit()
```{{1}}
```python
print(results.summary().tables[1])
```{{2}}
```python
=====================================================================================
                        coef    std err          z      P>|z|      [0.025      0.975]
-------------------------------------------------------------------------------------
const                 3.9819      1.363      2.920      0.004       1.310       6.654
ar.L1.time_series     0.4545      0.035     13.063      0.000       0.386       0.523
ar.L2.time_series     0.5216      0.033     15.729      0.000       0.457       0.587
ma.L1.time_series     0.5510      0.036     15.141      0.000       0.480       0.622
ma.L2.time_series    -0.4490      0.036    -12.385      0.000      -0.520      -0.378
=====================================================================================
```{{2}}


`@script`
If we want to fit this more complex data set then, just like before, we define the number of autoregressive and moving average lags, and create a model object. This time we have two autoregressive lags and two moving average lags.

Then we fit the model and assign the returned results object to the variable results

Finally we print the model parameters from the results object. You can see that the two AR coefficients are close to the two AR coefficients we used to generate the data and that the two MA coefficients are also close in value to the two we used to generate the data.

You will use what we have learned here to generate your own ARMA data and fit your own ARMA models.


---
## Let's practice!

```yaml
type: "FinalSlide"
key: "8ca7b9d309"
```

`@script`
Lets start practicing!

